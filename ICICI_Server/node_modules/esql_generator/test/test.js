var esqlGen = require('../server/esqlServer');

describe('GenerateESQL', function () {
  describe('#generateEsql()', function () {
    it('should generate an ESQL file based on parameters and file name', function (done) {
      var parameters = {
        "sourceType": "JSON",
        "targetType": "DFDL",
        "fieldDefinitions": [{
          "fieldName": "Virtual Account Number Verification IN",
          "fieldType": "Array",
          "format": "JSON",
          "preset": "source"
        }],
        "fields": [{
          "source": "Virtual Account Number Verification IN.items.properties.Client Code",
          "target": "ClientCode",
          "operation": "CAST:INTEGER"
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Virtual Account Number",
          "target": "VirtualAccountNumber",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Transaction Amount",
          "target": "TransactionAmount",
          "operation": "CAST:DECIMAL"
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Mode",
          "target": "PaymentMode",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.UTR number",
          "target": "UTRnumber",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Sender Name",
          "target": "SenderName",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Remitter Account Number",
          "target": "RemitterAccountNumber",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Sender IFSC_Code",
          "target": "SenderIFSC_Code",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Date",
          "target": "Date",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.sender to receiver information",
          "target": "sendertoreceiverinformation",
          "operation": ""
        }
        ]
      };


      var fileName = "test.esql";
      var template = "./templates/template.esql";
      // var targetTemplate = "./templates/templatenew.esql";
      // template = "/home/dell/Cateina/Devlopment/Nodejs/AllExperimentalWork/ICICI/Docs/ICICI_Template_30-10-2019/Scenario3/RequestScn3Template.esql";
      var data = esqlGen.generateEsql(template, parameters, fileName);

      if (data) done();

      else done("Error!")

    });
  });
});


describe('GenerateESQLReject', function () {
  describe('#generateEsqlReject()', function () {
    it('should generate an ESQL file for Reject scenario based on template, parameters and file name', function (done) {
      var parametersReject = {
        "sourceType": "DFDL",
        "targetType": "XML",
        "fieldDefinitions": [{
          "fieldName": "Virtual Account Number Verification IN",
          "fieldType": "array",
          "format": "JSON",
          "preset": "source"
        }],
        "fields": [{
          "source": "RejectReason",
          "target": "Virtual Account Number Verification IN.items.properties.Reject Reason",
          "operation": "coalesce"
        }, {
          "source": "ValidationStatus",
          "target": "Virtual Account Number Verification IN.items.properties.Status",
          "operation": ""
        }, {
          "source": "RejectionReason",
          "target": "Virtual Account Number Verification IN.items.properties.Virtual Account Number",
          "operation": ""
        }, {
          "source": "Reserved7",
          "target": "Virtual Account Number Verification IN.items.properties.Transaction Amount",
          "operation": "CAST:INTEGER"
        }, {
          "source": "Reserved8",
          "target": "Virtual Account Number Verification IN.items.properties.Mode",
          "operation": ""
        }, {
          "source": "Reserved9",
          "target": "Virtual Account Number Verification IN.items.properties.UTR number",
          "operation": ""
        }, {
          "source": "Reserved10",
          "target": "Virtual Account Number Verification IN.items.properties.Sender Name",
          "operation": ""
        }
        ]
      };


      var fileNameReject = "testReject.esql";
      var templateReject = "./templates/templateReject.esql"
      // templateReject = "/home/dell/Cateina/Devlopment/Nodejs/AllExperimentalWork/ICICI/Docs/ICICI_Template_30-10-2019/Scenario3/AcceptScn3Template.esql"
      var dataReject = esqlGen.generateEsqlReject(templateReject, parametersReject, fileNameReject);
      if (dataReject) done();

      else done("Error!")
    });
  });
});


describe('GenerateESQLStatusCheck', function () {
  describe('#generateEsqlStatusCheck()', function () {
    it('should generate an ESQL file based on parameters and file name for Status Check', function (done) {
      var parameters = {
        "sourceType": "DFDL",
        "targetType": "Environment.JSON",
        "fieldDefinitions": [{
          "fieldName": "Virtual Account Number Verification IN",
          "fieldType": "array",
          "format": "JSON",
          "preset": "source"
        }],
        "fields": [{
          "source": "RejectReason",
          "target": "Virtual Account Number Verification IN.items.properties.Reject Reason",
          "operation": "coalesce"
        }, {
          "source": "ValidationStatus",
          "target": "Virtual Account Number Verification IN.items.properties.Status",
          "operation": ""
        }, {
          "source": "RejectionReason",
          "target": "Virtual Account Number Verification IN.items.properties.Virtual Account Number",
          "operation": ""
        }, {
          "source": "Reserved7",
          "target": "Virtual Account Number Verification IN.items.properties.Transaction Amount",
          "operation": ""
        }, {
          "source": "Reserved8",
          "target": "Virtual Account Number Verification IN.items.properties.Mode",
          "operation": ""
        }, {
          "source": "Reserved9",
          "target": "Virtual Account Number Verification IN.items.properties.UTR number",
          "operation": ""
        }, {
          "source": "Reserved10",
          "target": "Virtual Account Number Verification IN.items.properties.Sender Name",
          "operation": ""
        }
        ]
      };

      parameters = {
        sourceType: 'DFDL',
        targetType: 'Environment.JSON',
        fieldDefinitions: [],
        fields:
          [{
            source: 'Reserved7',
            target: 'Virtual Account Number Verification OUT.Item.Reserved7',
            operation: ''
          },
          {
            source: 'Reserved8',
            target: 'Virtual Account Number Verification OUT.Item.Reserved8',
            operation: ''
          },
          {
            source: 'Reserved9',
            target: 'Virtual Account Number Verification OUT.Item.Reserved9',
            operation: ''
          },
          {
            source: 'Reserved10',
            target: 'Virtual Account Number Verification OUT.Item.Reserved10',
            operation: ''
          }]
      }
      var fileName = "testStatusCheck.esql";
      var template = "./templates/templateStatusCheck.esql";
      //template = "/home/dell/Cateina/Devlopment/Nodejs/AllExperimentalWork/ICICI/Docs/ICICI_Template_30-10-2019/Scenario3/StatusCheckScn3Template.esql"
      var data = esqlGen.generateEsqlStatusCheck(template, parameters, fileName);

      if (data) done();

      else done("Error!")
    });
  });
});

describe('GenerateESQLReversal', function () {
  describe('#generateEsqlReversal()', function () {
    it('should generate an ESQL file based on parameters and file name', function (done) {
      var parameters = {
        "sourceType": "JSON",
        "targetType": "REVERSAL",
        "fieldDefinitions": [],
        "fields": [{
          "source": "Virtual Account Number Verification IN.items.properties.Client Code",
          "target": "ClientCode",
          "operation": "CAST:INTEGER"
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Virtual Account Number",
          "target": "VirtualAccountNumber",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Transaction Amount",
          "target": "TransactionAmount",
          "operation": "CAST:DECIMAL"
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Mode",
          "target": "PaymentMode",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.UTR number",
          "target": "UTRnumber",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Sender Name",
          "target": "SenderName",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Remitter Account Number",
          "target": "RemitterAccountNumber",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Sender IFSC_Code",
          "target": "SenderIFSC_Code",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Date",
          "target": "Date",
          "operation": ""
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.sender to receiver information",
          "target": "sendertoreceiverinformation",
          "operation": ""
        }
        ]
      };


      var fileName = "testReversal.esql";
      var template = "./templates/templateReversal.esql";
      // var targetTemplate = "./templates/templatenew.esql";
      // template = "/home/dell/Cateina/Devlopment/Nodejs/AllExperimentalWork/ICICI/Docs/ICICI_Template_30-10-2019/Scenario3/RequestScn3Template.esql";
      var data = esqlGen.generateEsqlReversal(template, parameters, fileName);

      if (data) done();

      else done("Error!")

    });
  });
});




describe('GenerateESQLISurePayRequest', function () {
  describe('#generateEsqlISurePayRequest()', function () {
    it('should generate an ESQL file for ISurePay Request scenario based on template, parameters and file name', function (done) {
      var parameters = {
        "sourceType": "JSON",
        "targetType": "XML:REF",
        "fieldDefinitions": [],
        "fields": [{
          "source": "Virtual Account Number Verification IN.items.properties.Client Code",
          "target": "ClientCode",
          "operation": "CAST:INTEGER"
        }, {
          "source": "Virtual Account Number Verification IN.items.properties.Virtual Account Number",
          "target": "VirtualAccountNumber",
          "operation": ""
        }
        ]
      }

      var fileName = "testISurePayRequest.esql";
      var template = "./templates/templateISurePayRequest.esql"
      // templateReject = "/home/dell/Cateina/Devlopment/Nodejs/AllExperimentalWork/ICICI/Docs/ICICI_Template_30-10-2019/Scenario3/AcceptScn3Template.esql"
      var data = esqlGen.generateEsqlISurePayRequest(template, parameters, fileName);
      if (data) done();

      else done("Error!")
    });
  });
});


describe('GenerateESQLISurePayResponse', function () {
  describe('#generateEsqlISurePayResponse()', function () {
    it('should generate an ESQL file for ISurePay Response scenario based on template, parameters and file name', function (done) {

      var parameters = {
        "sourceType": "XML:JSON",
        "targetType": "XML",
        "fieldDefinitions": [],
        "fields": [{
          "source": "Client_Code",
          "target": "Client_Code",
          "operation": ""
        }, {
          "source": "Client_Validate_No2",
          "target": "Client_Validate_No2",
          "operation": ""
        }, {
          "source": "Amount",
          "target": "Amount",
          "operation": ""
        }, {
          "source": "STATUS",
          "target": "STATUS",
          "operation": ""
        }, {
          "source": "REJECT_REASON",
          "target": "REJECT_REASON",
          "operation": ""
        }
        ]
      }
      var template = "./templates/templateISurePayResponse.esql";
      var fileName = "iSurePayResponse.esql";
      // templateReject = "/home/dell/Cateina/Devlopment/Nodejs/AllExperimentalWork/ICICI/Docs/ICICI_Template_30-10-2019/Scenario3/AcceptScn3Template.esql"
      var data = esqlGen.generateEsqlISurePayResponse(template, parameters, fileName);
      if (data) done();

      else done("Error!")
    });
  });
});