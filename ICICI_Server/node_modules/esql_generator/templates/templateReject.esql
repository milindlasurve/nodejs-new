

BROKER SCHEMA com.icici.xpress_connect.ecollection.reject


CREATE COMPUTE MODULE Ecollection_LEND_File_To_JSON_Response
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN

		DECLARE ns1 NAMESPACE 'http://www.icici.com/xpress-connect/ecollection';
		
		DECLARE i INTEGER 1;
		DECLARE statusLength INTEGER 0;
		DECLARE creditNarration CHARACTER;

		SET creditNarration = Environment.Variables.DFDL.ns1:REL_Input.record.PaymentMode ||'-'|| Environment.Variables.DFDL.ns1:REL_Input.record.VirtualAccountNumber ||'-'|| Environment.Variables.DFDL.ns1:REL_Input.record.UTR;
		SET Environment.Variables.Status[] = Select * from Database.STATUS_MASTER;
		
		SET statusLength = CARDINALITY(Environment.Variables.Status[]);
		
		Reject : WHILE (i <= statusLength) DO
			
			IF( UPPER (InputRoot.JSON.Data."Virtual Account Number Verification IN"."item"."Status") = Environment.Variables.Status[i].REFUND_STATUS) THEN
				SET OutputRoot.Properties.MessageFormat = 'DFDL';
				SET OutputRoot.Properties.MessageType = '{http://www.icici.com/xpress-connect/ecollection}:REL_AcceptReject';
				SET OutputRoot.Properties.MessageSet = '{Ecollection_Library}';			  
	
	
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.CustomerCode = Environment.Variables.DFDL.ns1:REL_Input.record.CustomerCode;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.VirtualAccountNumber = Environment.Variables.DFDL.ns1:REL_Input.record.VirtualAccountNumber;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.TransactionAmount = Environment.Variables.DFDL.ns1:REL_Input.record.TransactionAmount;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.UTR = Environment.Variables.DFDL.ns1:REL_Input.record.UTR;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.SenderIFSC = Environment.Variables.DFDL.ns1:REL_Input.record.SenderIFSC;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.SenderInformation = Environment.Variables.DFDL.ns1:REL_Input.record.SenderInformation;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.SenderAccountNumber = Environment.Variables.DFDL.ns1:REL_Input.record.SenderAccountNumber;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.SenderName = Environment.Variables.DFDL.ns1:REL_Input.record.SenderName;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.PaymentMode = Environment.Variables.DFDL.ns1:REL_Input.record.PaymentMode;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.CustomerAccountNumber = Environment.Variables.DFDL.ns1:REL_Input.record.CustomerAccountNumber;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.TransactionDate = Environment.Variables.DFDL.ns1:REL_Input.record.TransactionDate;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.Status = InputRoot.JSON.Data."Virtual Account Number Verification OUT".Item.Status;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.SenderBankName = Environment.Variables.DFDL.ns1:REL_Input.record.SenderBankName;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.Currency = Environment.Variables.DFDL.ns1:REL_Input.record.Currency;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.InReserved1 = Environment.Variables.DFDL.ns1:REL_Input.record.Reserved1;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.InReserved2 = Environment.Variables.DFDL.ns1:REL_Input.record.Reserved2;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.InReserved3 = Environment.Variables.DFDL.ns1:REL_Input.record.Reserved3;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.InReserved4 = Environment.Variables.DFDL.ns1:REL_Input.record.Reserved4;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.InReserved5 = Environment.Variables.DFDL.ns1:REL_Input.record.Reserved5;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.InReserved6 = Environment.Variables.DFDL.ns1:REL_Input.record.Reserved6;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.CreditAccountNumber = InputRoot.JSON.Data."Virtual Account Number Verification OUT".Item."Remitter Account Number";
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.CreditNarration = creditNarration;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.IFSC = Environment.Variables.DFDL.ns1:REL_Input.record.SenderIFSC;
				SET OutputRoot.DFDL.ns1:REL_AcceptReject.record.ValidationStatus = InputRoot.JSON.Data."Virtual Account Number Verification OUT".Item.Status;

							-- Code --

							-- Code End --

				PROPAGATE TO TERMINAL 'out1';
				LEAVE Reject;
				
			ELSEIF( UPPER (InputRoot.JSON.Data."Virtual Account Number Verification IN"."item"."Status") = Environment.Variables.Status[i].FT_STATUS) THEN
				
				CALL CopyEntireMessage();
				PROPAGATE TO TERMINAL 'out2';
				LEAVE Reject;
			END IF;
			
		SET i = i + 1;
	END WHILE;
	
	RETURN FALSE;
END;

CREATE PROCEDURE CopyMessageHeaders() BEGIN
	DECLARE I INTEGER 1;
	DECLARE J INTEGER;
	SET J = CARDINALITY(InputRoot.*[]);
	WHILE I < J DO
		SET OutputRoot.*[I] = InputRoot.*[I];
		SET I = I + 1;
	END WHILE;
END;

CREATE PROCEDURE CopyEntireMessage() BEGIN
	SET OutputRoot = InputRoot;
END;
END MODULE;